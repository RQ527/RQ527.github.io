<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>设计模式学习笔记 | RayQuester</title><meta name="author" content="RQ527"><meta name="copyright" content="RQ527"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本篇文章是学习设计模式过程中做的笔记（主要是每种设计模式的代码示例），部分代码和内容来自掘金社区。  设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。  为什么要学设计模式？ 设计模式来源众多专家的经验和智慧，它们是从许多优秀的软件系统中总结出的成功的、能够实现可维护性、复用的设计方案，使用这些方案将可以让我们避免做一些重复性的工作。 大">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式学习笔记">
<meta property="og:url" content="http://rq527.github.io/rq/cf6c3d31.html">
<meta property="og:site_name" content="RayQuester">
<meta property="og:description" content="本篇文章是学习设计模式过程中做的笔记（主要是每种设计模式的代码示例），部分代码和内容来自掘金社区。  设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。  为什么要学设计模式？ 设计模式来源众多专家的经验和智慧，它们是从许多优秀的软件系统中总结出的成功的、能够实现可维护性、复用的设计方案，使用这些方案将可以让我们避免做一些重复性的工作。 大">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://rq527.github.io/img/header.jpg">
<meta property="article:published_time" content="2023-05-29T08:10:26.110Z">
<meta property="article:modified_time" content="2023-05-29T08:21:32.198Z">
<meta property="article:author" content="RQ527">
<meta property="article:tag" content="设计模式">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://rq527.github.io/img/header.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://rq527.github.io/rq/cf6c3d31.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '设计模式学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-29 16:21:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/header.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 菜单</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/top.png')"><nav id="nav"><span id="blog-info"><a href="/" title="RayQuester"><span class="site-name">RayQuester</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 菜单</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">设计模式学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-29T08:10:26.110Z" title="发表于 2023-05-29 16:10:26">2023-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-29T08:21:32.198Z" title="更新于 2023-05-29 16:21:32">2023-05-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>71分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="设计模式学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>本篇文章是学习设计模式过程中做的笔记（主要是每种设计模式的代码示例），部分代码和内容来自掘金社区。</p>
<blockquote>
<p>设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。</p>
</blockquote>
<h2 id="为什么要学设计模式？"><a href="#为什么要学设计模式？" class="headerlink" title="为什么要学设计模式？"></a>为什么要学设计模式？</h2><ol>
<li>设计模式来源众多专家的经验和智慧，它们是从许多优秀的软件系统中总结出的成功的、能够实现可维护性、复用的设计方案，使用这些方案将可以让我们避免做一些重复性的工作。</li>
<li>大部分设计模式都兼顾了系统的可重用性和可扩展性，这使得我们可以更好地重用一些已有的设计方案、功能模块甚至一个完整的软件系统，避免我们经常做一些重复的设计、编写一些重复的代码</li>
<li>合理使用设计模式并对设计模式的使用情况进行文档化，将有助于别人更快地理解系统</li>
<li>学习设计模式有助于更加深入地理解面向对象思想，能够踏出架构的第一步。</li>
</ol>
<h2 id="设计模式种类"><a href="#设计模式种类" class="headerlink" title="设计模式种类"></a>设计模式种类</h2><p>设计模式一共分为三种类型：</p>
<ol>
<li>创造型设计模式：单例模式、简单工厂模式、抽象工厂模式、建造者模式、原型模式</li>
<li>结构型设计模式：适配器模式、装饰器模式、代理模式、外观模式、桥接模式、组合模式、享元模式。</li>
<li>行为型设计模式：策略模式、模板方法模式、观察者模式、迭代子模式、责任链模式、命令模式、备忘录模式、状态模式、访问者模式、中介者模式、解释器模式。</li>
</ol>
<h2 id="遵循的七大原则"><a href="#遵循的七大原则" class="headerlink" title="遵循的七大原则"></a>遵循的七大原则</h2><p>设计模式遵循六大原则：</p>
<ol>
<li><p>单一职责原则</p>
<blockquote>
<p>每个类应该实现单一的职责。一个职责的变化可能会削弱或者抑制这个类完成其他职责的能力。这会导致脆弱的设计。当一个职责发生变化时，可能会影响其它的职责。另外，多个职责耦合在一起，会影响复用性。想要避免这种现象的发生，就要尽可能的遵守单一职责原则。</p>
<p>单一职责原则的核心就是解耦和增强内聚性。</p>
</blockquote>
</li>
<li><p>里氏替换原则</p>
<blockquote>
<p>里式替换原则是用来帮助我们在继承关系中进行父子类的设计。</p>
<p>应用程序中任何父类对象出现的地方，我们都可以用其子类的对象来替换，并且可以保证原有程序的逻辑行为和正确性。</p>
<p>不符合里氏替换原则的最常见的情况是，父类和子类都是可实例化的非抽象类，且父类的方法被子类重新定义，这一类的实现继承会造成父类和子类间的强耦合，也就是实际上并不相关的属性和方法牵强附会在一起，不利于程序扩展和维护。</p>
</blockquote>
</li>
<li><p>依赖倒置原则</p>
<blockquote>
<ol>
<li>高层模块不应该依赖低层模块，两者都应该依赖其抽象. 不可分割的原子逻辑就是低层模式，原子逻辑组装成的就是高层模块。</li>
<li>抽象不应该依赖细节 java 中，抽象 -&gt; 接口或抽象类；细节 -&gt; 实现类</li>
<li>细节应该依赖抽象</li>
</ol>
<p>依赖倒转原则就是要针对接口编程，不要针对实现编程。这就是说，应当使用接口或者抽象类进行<strong>变量的类型声明</strong>，<strong>参数的类型声明</strong>，<strong>方法的返回类型说明</strong>，<strong>以及数据类型的转换</strong>等。</p>
<p>在java中体现为多态的使用</p>
</blockquote>
</li>
<li><p>接口隔离原则</p>
<blockquote>
<p>每个接口中不存在子类用不到却必须实现的方法，如果不然，就要将接口拆分。使用多个隔离的接口，比使用单个接口（多个接口方法集合到一个的接口）要好。</p>
</blockquote>
</li>
<li><p>迪米特法则</p>
<blockquote>
<p>也称为最少知识原则： <strong>一个对象应该对其他对象有最少的了解。对类的低耦合提出了明确的要求</strong></p>
<p>只与直接的朋友通信。类之间只要有耦合关系，就叫朋友关系。耦合分为依赖、关联、聚合、组合等。我们称出现为成员变量、方法参数、方法返回值中的类为直接朋友。局部变量、临时变量则不是直接的朋友。我们要求陌生的类不要作为局部变量出现在类中。</p>
</blockquote>
</li>
<li><p>开闭原则</p>
<blockquote>
<p><strong>对扩展开放，对修改封闭</strong></p>
<p>开放封闭原则是所有面向对象原则的核心。软件设计本身所追求的目标就是封装变化、降低耦合，而开放封闭原则正是对这一目标的最直接体现。其他的设计原则，很多时候是为实现这一目标服务的.</p>
</blockquote>
</li>
<li><p>合成复用原则</p>
<blockquote>
<p>原则是尽量使用合成&#x2F;聚合的方式，而不是使用继承。</p>
</blockquote>
</li>
</ol>
<h2 id="创造型模式"><a href="#创造型模式" class="headerlink" title="创造型模式"></a>创造型模式</h2><h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><blockquote>
<p>单例模式主要是为了避免因为创建了多个实例造成资源的浪费，且多个实例由于多次调用容易导致结果出现错误，而<strong>使用单例模式能够保证整个应用中有且只有一个实例</strong>。</p>
</blockquote>
<p>单例在于只有一个实例，所以必须私有化构造函数再向外暴露提供唯一实例的方法。</p>
<ol>
<li><p>饿汉式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">HungrySingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HungrySingleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> HungrySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;饿汉式单例工作中.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好处：使用类加载机制避开线程安全问题</p>
<p>缺点：类加载的时候就创建实例，内存利用率低。</p>
</li>
<li><p>懒汉式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">synchronized</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;懒汉式单例工作中.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好处：懒加载，提高内存利用率，synchronized保证线程安全</p>
<p>缺点：synchronized作用的是整个getInstance方法，每次都要经过判断锁，等待锁，释放锁这些过程。</p>
</li>
<li><p>静态内部类单例（推荐）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InnerSingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">InnerSingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> InnerSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;静态内部类单例工作中.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">InnerSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InnerSingleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与饿汉式不同的是静态内部类利用内部类达到了懒加载的效果，类加载保证线程安全。</p>
</li>
<li><p>双重校验锁（推荐）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TwoIfSingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">TwoIfSingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> TwoIfSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> TwoIfSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (TwoIfSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">TwoIfSingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;双重校验锁单例类工作中.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>双重校验指的就是两次if判断，第一次是避免不必要的锁等待，第二次是避免重复new 实例。而new TwoIfSingleton并不是原子操作，不是原子操作就可能发生指令重排序，volatile关键字的一个作用是禁止指令重排，把instance声明为volatile之后，对它的写操作就会有一个内存屏障，这样，在它的赋值完成之前，就不用会调用读操作。关于volatile指令重排因为篇幅原因这里不再赘述，大家可自行查阅。</p>
</li>
<li><p>枚举类实现单例</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> &#123;</span><br><span class="line">    instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;枚举类单例工作中.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用java枚举类的特性实现私有化构造函数，反序列化创建对象。但没有懒加载的效果。</p>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><p>工厂模式其实就是产品和客户之间的解耦，客户通过工厂去获取相应的产品。</p>
<p>工厂模式包含了简单工厂模式，工厂方法模式和抽象工厂模式。</p>
<h4 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h4><p>我们从一个例子入手。假设我们现在需要生产不同类型的形状，包括圆，三角形，四边形，平行四边形等等。</p>
<p>首先定义一个Shape接口，有一个draw方法。然后定义几个图形产品：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Triangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Oval</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制椭圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再定义一个生产产品的工厂。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Shape <span class="title function_">createShape</span><span class="params">(String type)</span>&#123;</span><br><span class="line">        Shape shape;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;三角形&quot;</span>:</span><br><span class="line">                shape = <span class="keyword">new</span> <span class="title class_">Triangle</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;矩形&quot;</span>:</span><br><span class="line">                shape = <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;椭圆形&quot;</span>:</span><br><span class="line">                shape = <span class="keyword">new</span> <span class="title class_">Oval</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;圆形&quot;</span>:</span><br><span class="line">                shape = <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                shape = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后模拟一下客户获取产品的过程：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactoryDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> ShapeFactory.createShape(<span class="string">&quot;圆形&quot;</span>);</span><br><span class="line">        circle.draw();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> ShapeFactory.createShape(<span class="string">&quot;矩形&quot;</span>);</span><br><span class="line">        rectangle.draw();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">oval</span> <span class="operator">=</span> ShapeFactory.createShape(<span class="string">&quot;椭圆形&quot;</span>);</span><br><span class="line">        oval.draw();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">triangle</span> <span class="operator">=</span> ShapeFactory.createShape(<span class="string">&quot;三角形&quot;</span>);</span><br><span class="line">        triangle.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果达到了我们的预期：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">绘制圆形</span><br><span class="line">绘制矩形</span><br><span class="line">绘制椭圆形</span><br><span class="line">绘制三角形</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h4 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h4><p>但是在上面的 的简单工程模式中你们有没有发现它解耦了但是没完全解耦，因为我每增加一个产品然后就要在工厂的switch里面去添加一个分支，耦合度似乎有点高。而工厂方法模式就将生产产品本身交给一个新的工厂，这样客户想要一个产品只需要知道产品的名字就行了。</p>
<p>我们产品还是不变：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Triangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Oval</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制椭圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>工厂的定义改变一下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IFactory</span> &#123;</span><br><span class="line">    Shape <span class="title function_">createShape</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RectangleFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TriangleFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Triangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OvalFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Oval</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是客户使用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactoryDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">circleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CircleFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> circleFactory.createShape();</span><br><span class="line">        circle.draw();</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">ovalFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OvalFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">oval</span> <span class="operator">=</span> ovalFactory.createShape();</span><br><span class="line">        oval.draw();</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">rectangleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RectangleFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> rectangleFactory.createShape();</span><br><span class="line">        rectangle.draw();</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">triangleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TriangleFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">triangle</span> <span class="operator">=</span> triangleFactory.createShape();</span><br><span class="line">        triangle.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到工厂和产品达到了一定程度的解耦，客户只需要知道产品的名字就可以了。但是每件产品都对应一个工厂，上千上万件产品那工厂的数量不起飞了。所以就有了抽象工厂模式：</p>
<h4 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h4><p>抽象工厂和工厂方法的不同在于，工厂方法一个工厂只能生产一个具体的产品。而抽象工厂一个工厂能生产一组类型相同的产品。只有新增类型的产品时才会增加工厂。</p>
<p>这里我们再举一个例子，有手机，平板，电脑等几系列产品，然后有小米，苹果，华为等几个生产这些产品的工厂。用工厂方法模式肯定不行，工厂太多了。</p>
<p>我们来看看抽象工厂，先定义一系列的产品：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IPhone</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">playPhone</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IPad</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">playPad</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IComputer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">playComputer</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplePhone</span> <span class="keyword">implements</span> <span class="title class_">IPhone</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;苹果手机欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplePad</span> <span class="keyword">implements</span> <span class="title class_">IPad</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPad</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;苹果Pad欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppleComputer</span> <span class="keyword">implements</span> <span class="title class_">IComputer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;苹果电脑欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiPhone</span> <span class="keyword">implements</span> <span class="title class_">IPhone</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;华为手机欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiPad</span> <span class="keyword">implements</span> <span class="title class_">IPad</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPad</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;华为Pad欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiComputer</span> <span class="keyword">implements</span> <span class="title class_">IComputer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;华为电脑欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaomiPhone</span> <span class="keyword">implements</span> <span class="title class_">IPhone</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;小米手机欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaomiPad</span> <span class="keyword">implements</span> <span class="title class_">IPad</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playPad</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;小米Pad欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaomiComputer</span> <span class="keyword">implements</span> <span class="title class_">IComputer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;小米电脑欢迎您~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后定义工厂：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IFactory</span> &#123;</span><br><span class="line">    IPhone <span class="title function_">createPhone</span><span class="params">()</span>;</span><br><span class="line">    IPad <span class="title function_">createPad</span><span class="params">()</span>;</span><br><span class="line">    IComputer <span class="title function_">createComputer</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppleFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPhone <span class="title function_">createPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApplePhone</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPad <span class="title function_">createPad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApplePad</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IComputer <span class="title function_">createComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AppleComputer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPhone <span class="title function_">createPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPhone</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPad <span class="title function_">createPad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPad</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IComputer <span class="title function_">createComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiComputer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaomiFactory</span> <span class="keyword">implements</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPhone <span class="title function_">createPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XiaomiPhone</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPad <span class="title function_">createPad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XiaomiPad</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IComputer <span class="title function_">createComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XiaomiComputer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后模拟客户：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractFactoryDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">huaweiFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuaweiFactory</span>();</span><br><span class="line">        <span class="type">IPhone</span> <span class="variable">huaweiPhone</span> <span class="operator">=</span> huaweiFactory.createPhone();</span><br><span class="line">        <span class="type">IPad</span> <span class="variable">huaweiPad</span> <span class="operator">=</span> huaweiFactory.createPad();</span><br><span class="line">        <span class="type">IComputer</span> <span class="variable">huaweiComputer</span> <span class="operator">=</span> huaweiFactory.createComputer();</span><br><span class="line">        huaweiPhone.playPhone();</span><br><span class="line">        huaweiPad.playPad();</span><br><span class="line">        huaweiComputer.playComputer();</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">appleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AppleFactory</span>();</span><br><span class="line">        <span class="type">IPhone</span> <span class="variable">applePhone</span> <span class="operator">=</span> appleFactory.createPhone();</span><br><span class="line">        <span class="type">IPad</span> <span class="variable">applePad</span> <span class="operator">=</span> appleFactory.createPad();</span><br><span class="line">        <span class="type">IComputer</span> <span class="variable">appleComputer</span> <span class="operator">=</span> appleFactory.createComputer();</span><br><span class="line">        applePhone.playPhone();</span><br><span class="line">        applePad.playPad();</span><br><span class="line">        appleComputer.playComputer();</span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">xiaomiFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XiaomiFactory</span>();</span><br><span class="line">        <span class="type">IPhone</span> <span class="variable">xiaomiPhone</span> <span class="operator">=</span> xiaomiFactory.createPhone();</span><br><span class="line">        <span class="type">IPad</span> <span class="variable">xiaomiPad</span> <span class="operator">=</span> xiaomiFactory.createPad();</span><br><span class="line">        <span class="type">IComputer</span> <span class="variable">xiaomiComputer</span> <span class="operator">=</span> xiaomiFactory.createComputer();</span><br><span class="line">        xiaomiPhone.playPhone();</span><br><span class="line">        xiaomiPad.playPad();</span><br><span class="line">        xiaomiComputer.playComputer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">华为手机欢迎您~</span><br><span class="line">华为Pad欢迎您~</span><br><span class="line">华为电脑欢迎您~</span><br><span class="line">苹果手机欢迎您~</span><br><span class="line">苹果Pad欢迎您~</span><br><span class="line">苹果电脑欢迎您~</span><br><span class="line">小米手机欢迎您~</span><br><span class="line">小米Pad欢迎您~</span><br><span class="line">小米电脑欢迎您~</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到这里有9个产品，但只需要三个工厂。抽象工厂的精髓就在于一个工厂负责生产一系列的产品，而不是一个工厂生产一种产品从而减少工厂类也成功解耦了产品和客户。</p>
<h3 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h3><p>建造者模式（Builder Pattern） 又叫生成器模式，是一种对象构建模式。它可以将复杂对象的建造过程抽象出来（抽象类别），使这个抽象过程的不同实现方 法可以构造出不同表现（属性）的对象。</p>
<p><strong>需要用建造者模式的场景</strong>：</p>
<ol>
<li>需要生成的产品对象有复杂的内部结构，这些产品对象通常包含多个成员变量。</li>
<li>需要生成的产品对象的属性相互依赖，需要指定其生成顺序。</li>
<li>对象的创建过程独立于创建该对象的类。在建造者模式中通过引入指挥者类将创建过程封装在指挥者类中，而不再建造者类和客户类中。</li>
<li>隔离复杂对象的创建和使用，并使得相同的创建过程可以创建不同的产品。</li>
</ol>
<p><strong>角色</strong>：</p>
<p><strong>Builder（抽象建造者）</strong>：它为创建一个产品Product对象的各个部件指定抽象接口，在该接口中一般声明两类方法，一类方法是buildPartX()，它们用于创建复杂对象的各个部件；另一类方法是getResult()，它们用于返回复杂对象。Builder既可以是抽象类，也可以是接口。</p>
<p><strong>ConcreteBuilder（具体建造者）</strong>：它实现了Builder接口，实现各个部件的具体构造和装配方法，定义并明确它所创建的复杂对象，也可以提供一个方法返回创建好的复杂产品对象。</p>
<p><strong>Product（产品角色）</strong>：它是被构建的复杂对象，包含多个组成部件，具体建造者创建该产品的内部表示并定义它的装配过程。</p>
<p><strong>Director（指挥者）</strong>：指挥者又称为导演类，它负责安排复杂对象的建造次序，指挥者与抽象建造者之间存在关联关系，可以在其construct()建造方法中调用建造者对象的部件构造与装配方法，完成复杂对象的建造。客户端一般只需要与指挥者进行交互，在客户端确定具体建造者的类型，并实例化具体建造者对象（也可以通过配置文件和反射机制），然后通过指挥者类的构造函数或者Setter方法将该对象传入指挥者类中。</p>
<p>我们举个例子，比如造手机：</p>
<p>首先定义产品Product：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cpu;</span><br><span class="line">    <span class="keyword">private</span> String gpu;</span><br><span class="line">    <span class="keyword">private</span> String battery;</span><br><span class="line">    <span class="keyword">private</span> String screen;</span><br><span class="line">    <span class="keyword">private</span> String camera;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(String cpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGpu</span><span class="params">(String gpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gpu = gpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBattery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> battery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBattery</span><span class="params">(String battery)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.battery = battery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getScreen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> screen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScreen</span><span class="params">(String screen)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.screen = screen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCamera</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> camera;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCamera</span><span class="params">(String camera)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.camera = camera;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU：&quot;</span> + cpu + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;GPU：&quot;</span> + gpu + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Camera：&quot;</span> + camera + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Screen：&quot;</span> + screen + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Battery：&quot;</span> + battery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象建造者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setScreen</span><span class="params">(String screen)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(String cpu)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setBattery</span><span class="params">(String battery)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setCamera</span><span class="params">(String camera)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setGPU</span><span class="params">(String gpu)</span>;</span><br><span class="line"></span><br><span class="line">    Phone <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建ConcreteBuilder具体建造者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneBuilder</span> <span class="keyword">extends</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScreen</span><span class="params">(String screen)</span> &#123;</span><br><span class="line">        phone.setScreen(screen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(String cpu)</span> &#123;</span><br><span class="line">        phone.setCpu(cpu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBattery</span><span class="params">(String battery)</span> &#123;</span><br><span class="line">        phone.setBattery(battery);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCamera</span><span class="params">(String camera)</span> &#123;</span><br><span class="line">        phone.setCamera(camera);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGPU</span><span class="params">(String gpu)</span> &#123;</span><br><span class="line">        phone.setGpu(gpu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建Director（指挥者）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Director</span> &#123;</span><br><span class="line">    Phone <span class="title function_">direct</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        builder.setScreen(<span class="string">&quot;6.7英寸 120hz&quot;</span>);</span><br><span class="line">        builder.setCpu(<span class="string">&quot;A16&quot;</span>);</span><br><span class="line">        builder.setGPU(<span class="string">&quot;5核&quot;</span>);</span><br><span class="line">        builder.setBattery(<span class="string">&quot;20w 3279mh&quot;</span>);</span><br><span class="line">        builder.setCamera(<span class="string">&quot;4800万像素&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模拟客户端：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Director</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>();</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> director.direct(<span class="keyword">new</span> <span class="title class_">PhoneBuilder</span>());</span><br><span class="line">        System.out.println(phone);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CPU：A16</span><br><span class="line">GPU：5核</span><br><span class="line">Camera：4800万像素</span><br><span class="line">Screen：6.7英寸 120hz</span><br><span class="line">Battery：20w 3279mh</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>这就是建造者模式的全部步骤。</p>
<p>在日常使用中，如果不需要多类型的Builder，Builder更多是作为产品的内部类，还是拿上面的例子，改一下Product，将具体的Builder作为内部类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cpu;</span><br><span class="line">    <span class="keyword">private</span> String gpu;</span><br><span class="line">    <span class="keyword">private</span> String battery;</span><br><span class="line">    <span class="keyword">private</span> String screen;</span><br><span class="line">    <span class="keyword">private</span> String camera;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(String cpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGpu</span><span class="params">(String gpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gpu = gpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBattery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> battery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBattery</span><span class="params">(String battery)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.battery = battery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getScreen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> screen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScreen</span><span class="params">(String screen)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.screen = screen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCamera</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> camera;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCamera</span><span class="params">(String camera)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.camera = camera;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setScreen</span><span class="params">(String screen)</span> &#123;</span><br><span class="line">            phone.setScreen(screen);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setCpu</span><span class="params">(String cpu)</span> &#123;</span><br><span class="line">            phone.setCpu(cpu);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setBattery</span><span class="params">(String battery)</span> &#123;</span><br><span class="line">            phone.setBattery(battery);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setCamera</span><span class="params">(String camera)</span> &#123;</span><br><span class="line">            phone.setCamera(camera);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setGPU</span><span class="params">(String gpu)</span> &#123;</span><br><span class="line">            phone.setGpu(gpu);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Phone <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> phone;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU：&quot;</span> + cpu + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;GPU：&quot;</span> + gpu + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Camera：&quot;</span> + camera + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Screen：&quot;</span> + screen + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;Battery：&quot;</span> + battery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后客户端就直接优雅地链式调用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>.Builder()</span><br><span class="line">                .setScreen(<span class="string">&quot;6.7英寸 120hz&quot;</span>)</span><br><span class="line">                .setCpu(<span class="string">&quot;A16&quot;</span>)</span><br><span class="line">                .setGPU(<span class="string">&quot;5核&quot;</span>)</span><br><span class="line">                .setBattery(<span class="string">&quot;20w 3279mh&quot;</span>)</span><br><span class="line">                .setCamera(<span class="string">&quot;4800万像素&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(phone);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CPU：A16</span><br><span class="line">GPU：5核</span><br><span class="line">Camera：4800万像素</span><br><span class="line">Screen：6.7英寸 120hz</span><br><span class="line">Battery：20w 3279mh</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>与工厂模式不同的是，建造者模式更关注产品的内部构造，工厂模式更关注的是生产。</p>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><p><strong>定义</strong>：原型模式（Prototype）是指使用原型实例指定创建对象的种类，并且通过拷贝这个模型，创建新的对象</p>
<p>java中自带了克隆的方法，类实现Clonable接口，重写clone方法即可。但是java的clone方法对于基本的数据类型是深拷贝，对于引用数据类型的变量是浅拷贝，如果要实现深拷贝就必须一层一层去重写clone方法。</p>
<p>例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="comment">//基本数据类型变量</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;王二&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">    <span class="comment">//引用类型变量</span></span><br><span class="line">    <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">clone</span> <span class="operator">=</span> (User) user.clone();</span><br><span class="line">        clone.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        clone.age = <span class="number">14</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----基本数据类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.name=&quot;</span>+user.name+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.name=&quot;</span>+clone.name);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.age=&quot;</span>+user.age+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.age=&quot;</span>+clone.age);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----引用类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.test=&quot;</span>+user.test+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.test=&quot;</span>+clone.test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----基本数据类型是否相等--------</span><br><span class="line">user.name=王二,clone.name=张三</span><br><span class="line">user.age=13,clone.age=14</span><br><span class="line">-----引用类型是否相等--------</span><br><span class="line">user.test=prototype.Test@3feba861,clone.test=prototype.Test@3feba861</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到，基本数据类型是深拷贝，引用类型是浅拷贝，地址没变。假如我改变了clone的test属性那原型的test属性肯定也会改变，这不是原型模式。</p>
<p>而Test类要实现深拷贝就必须实现Cloneable接口，然后User类重写clone方法将test类克隆：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="comment">//基本数据类型变量</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;王二&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">    <span class="comment">//引用类型变量</span></span><br><span class="line">    <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">clone</span> <span class="operator">=</span> (User) <span class="built_in">super</span>.clone();</span><br><span class="line">        clone.test = (Test) test.clone();</span><br><span class="line">        <span class="keyword">return</span> clone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">clone</span> <span class="operator">=</span> (User) user.clone();</span><br><span class="line">        clone.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        clone.age = <span class="number">14</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----基本数据类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.name=&quot;</span>+user.name+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.name=&quot;</span>+clone.name);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.age=&quot;</span>+user.age+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.age=&quot;</span>+clone.age);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----引用类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.test=&quot;</span>+user.test+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;clone.test=&quot;</span>+clone.test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----基本数据类型是否相等--------</span><br><span class="line">user.name=王二,clone.name=张三</span><br><span class="line">user.age=13,clone.age=14</span><br><span class="line">-----引用类型是否相等--------</span><br><span class="line">user.test=prototype.Test@3feba861,clone.test=prototype.Test@5b480cf9</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到，test变量地址变了，不是指向的同一个对象。这就实现了标准的克隆。</p>
<p>但是这里就有一个问题了，假如我有很多个引用类型的变量，引用类型变量里面还有引用类型变量，那我要实现深拷贝就得一个一个类地去修改，麻烦不说还容易漏掉。而且每次都去修改原型类侵入性有点大，不符合”开闭原则“。</p>
<p>那么怎么办呢，最简单的一种方式就是序列化和反序列化，怎么做？往下看：</p>
<p>我们只用重写克隆体的clone方法，然后每个引用类型的类要实现Serializable接口才能序列化。然后序列化将其写入文件，再序列化读出文件，这样他们肯定不是指向同一个地址。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">implements</span>  <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>,Serializable &#123;</span><br><span class="line">    <span class="comment">//基本数据类型变量</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;王二&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">    <span class="comment">//引用类型变量</span></span><br><span class="line">    <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">            oos.writeObject(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">            <span class="keyword">return</span> ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">clone</span> <span class="operator">=</span> (User) user.clone();</span><br><span class="line">        clone.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        clone.age = <span class="number">14</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----基本数据类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.name=&quot;</span> + user.name + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;clone.name=&quot;</span> + clone.name);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.age=&quot;</span> + user.age + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;clone.age=&quot;</span> + clone.age);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----引用类型是否相等--------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user.test=&quot;</span> + user.test + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;clone.test=&quot;</span> + clone.test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----基本数据类型是否相等--------</span><br><span class="line">user.name=王二,clone.name=张三</span><br><span class="line">user.age=13,clone.age=14</span><br><span class="line">-----引用类型是否相等--------</span><br><span class="line">user.test=prototype.Test@4bf558aa,clone.test=prototype.Test@7dc5e7b4</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>同样实现了深拷贝，相比第一种方法，这种方法代码侵入性更小，更推荐。</p>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><p><strong>定义</strong>：将一个类的接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法在一起工作的两个类能够在一起工作。</p>
<p><strong>角色</strong>：</p>
<p><strong>Target目标角色</strong>：该角色定义把其他类转化为何种接口</p>
<p><strong>Adaptee源角色</strong>：想把谁转化为目标角色，谁就是源角色，是已经存在的，运行良好的接口。</p>
<p><strong>Adaptor适配器角色</strong>：适配器模式的核心角色，其他两个角色都是已经存在的，只有这个角色需要新创建，将源角色转化为目标角色。通过类继承或类关联的方式。</p>
<p>举个例子，原本A类有过滤词汇里面脏话的功能，现在新添加了一个新地B类有过滤词汇里面政治敏感的功能，现在要两个功能一起用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//老的类，就是adaptee</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ASensitive</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">filterDirty</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理脏话词汇......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BSensitive</span> <span class="keyword">implements</span> <span class="title class_">Target</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理政治敏感词汇.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后构建适配器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//抽象公共的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//适配老的功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adapter</span> <span class="keyword">implements</span> <span class="title class_">Target</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ASensitive</span> <span class="variable">adaptee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ASensitive</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Adapter</span><span class="params">(ASensitive adaptee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">()</span> &#123;</span><br><span class="line">        adaptee.filterDirty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试一起使用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//添加到一个集合里面</span></span><br><span class="line">        ArrayList&lt;Target&gt; targets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Target</span> <span class="variable">oldFeature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Adapter</span>(<span class="keyword">new</span> <span class="title class_">ASensitive</span>());</span><br><span class="line">        <span class="type">Target</span> <span class="variable">newFeature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BSensitive</span>();</span><br><span class="line">        targets.add(oldFeature);</span><br><span class="line">        targets.add(newFeature);</span><br><span class="line">		<span class="comment">//这里就模拟了老的功能和新功能一起使用的情况</span></span><br><span class="line">        <span class="keyword">for</span> (Target target : targets) &#123;</span><br><span class="line">            target.filter();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">处理脏话词汇......</span><br><span class="line">处理政治敏感词汇.....</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>上面是适配对象，适配类的话，直接继承即可：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adapter</span> <span class="keyword">extends</span> <span class="title class_">ASensitive</span> <span class="keyword">implements</span> <span class="title class_">Target</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.filterDirty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后客户端测试，区别就在于少了一个参数：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//添加到一个集合里面</span></span><br><span class="line">        ArrayList&lt;Target&gt; targets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Target</span> <span class="variable">oldFeature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Adapter</span>();</span><br><span class="line">        <span class="type">Target</span> <span class="variable">newFeature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BSensitive</span>();</span><br><span class="line">        targets.add(oldFeature);</span><br><span class="line">        targets.add(newFeature);</span><br><span class="line">		<span class="comment">//这里就模拟了老的功能和新功能一起使用的情况</span></span><br><span class="line">        <span class="keyword">for</span> (Target target : targets) &#123;</span><br><span class="line">            target.filter();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">处理脏话词汇......</span><br><span class="line">处理政治敏感词汇.....</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h3 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h3><p><strong>定义</strong>：装饰模式就是在不必改变原类文件和使用继承的情况下，动态地扩展一个对象地功能。他是通过创建一个包装对象，也就是装饰来包裹真实的对象。</p>
<p><strong>角色</strong>：</p>
<ol>
<li>抽象构件（Component）角色：给出一个抽象接口，以规范准备接收附加责任的对象。</li>
<li>具体构件（Concrete Component）角色：定义一个将要接收附加责任的类。</li>
<li>装饰（Decorator）角色：持有一个构件（Component）对象的实例，并实现一个与抽象构件接口一致的接口。</li>
<li>具体装饰（Concrete Decorator）角色：负责给构件对象添加上附加的责任。</li>
</ol>
<p>这里举个例子，就拿图形来说吧。</p>
<p>定义抽象构件（Component）角色，Shape：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体构件（Concrete Component）角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Oval</span> <span class="keyword">implements</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;椭圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>装饰（Decorator）角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Shape shape;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShapeDecorator</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.shape = shape;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        shape.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体装饰（Concrete Decorator）角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Black</span> <span class="keyword">extends</span> <span class="title class_">ShapeDecorator</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Black</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(shape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.draw();</span><br><span class="line">        System.out.println(<span class="string">&quot;黑色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blue</span> <span class="keyword">extends</span> <span class="title class_">ShapeDecorator</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Blue</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(shape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.draw();</span><br><span class="line">        System.out.println(<span class="string">&quot;蓝色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stroke</span> <span class="keyword">extends</span> <span class="title class_">ShapeDecorator</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Stroke</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(shape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.draw();</span><br><span class="line">        System.out.println(<span class="string">&quot;描边&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//黑色有描边的圆形</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        circle = <span class="keyword">new</span> <span class="title class_">Black</span>(circle);</span><br><span class="line">        circle = <span class="keyword">new</span> <span class="title class_">Stroke</span>(circle);</span><br><span class="line">        circle.draw();</span><br><span class="line">		System.out.println(<span class="string">&quot;------------------&quot;</span>);</span><br><span class="line">        <span class="comment">//蓝色的椭圆</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">oval</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Oval</span>();</span><br><span class="line">        oval = <span class="keyword">new</span> <span class="title class_">Blue</span>(oval);</span><br><span class="line">        oval.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就是一层一层去套娃加功能装饰，输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">圆形</span><br><span class="line">黑色</span><br><span class="line">描边</span><br><span class="line">------------------</span><br><span class="line">椭圆形</span><br><span class="line">蓝色</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>到这里可能会有人会疑问，这装饰模式怎么和适配器有点像啊？</p>
<p>确实，二者实现结构上有点相似，但是各自实现的效果不同。适配器模式是将原有接口转变成另外一个接口，达成新接口适配老接口从而新老接口都能以一种方式使用也就是复用的目的。而装饰模式相反不改变原有接口而是保留原有接口增强原有接口的功能。</p>
<h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>定义：为其他对象提供一种代理以控制对这个对象的访问</p>
<p>代理意在客户和对象之间做中介的作用。生活中也不乏这些例子。比如客户和火车站之间通过中介买票。租房子通过中介联系房东等等。</p>
<p>代理模式总共就三个角色，包括<strong>抽象主题，委托者和代理者</strong>。</p>
<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><p>代理者在编译时就能确定的称为静态代理。</p>
<p>举例，客户找中介租房子的例子。</p>
<p><strong>抽象主题</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rentHouse</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>委托者</strong>，也就是被代理者房东：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Landlord</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rentHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房东租出房子，1000元/月。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代理者</strong>，也就是中介：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyMediator</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span>&#123;</span><br><span class="line">    <span class="comment">//代理者拥有委托者的引用</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Mediator</span> <span class="variable">mediator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Landlord</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rentHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;代理开始&quot;</span>);</span><br><span class="line">        mediator.rentHouse();</span><br><span class="line">        System.out.println(<span class="string">&quot;代理结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建代理者</span></span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyMediator</span>();</span><br><span class="line">        <span class="comment">//通过代理者找房子</span></span><br><span class="line">        proxy.rentHouse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">中介代理开始找房子.....</span><br><span class="line">房东租出房子，1000元/月。</span><br><span class="line">代理结束。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>到这里可能又有人会有疑问，我直接调用委托者的方法不行吗？意思就是我直接去找这个房东不行吗？</p>
<p>你知道有这个房东的存在你当然可以直接去找他呀，还省了一笔中介费。但是现在是你不知道这个房东的联系方式，你也不想到处去找，去跑，你直接把你的要求告诉了中介，中介替你去找。这就是代理的作用。客户不需要关注委托者是谁，只需关注需求和功能。</p>
<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>代理者在运行时才能确定的称为动态代理。</p>
<p>Java为开发者提供了InvocationHandler,实现该接口重写其invoke 方法即可实现动态代理。</p>
<p>还是拿刚刚的例子，我们现在不知道ProxyMediator的存在。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//抽象主题</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rentHouse</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//委托者（房东）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Landlord</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rentHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房东租出房子，1000元/月。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//客户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//动态创建代理者（反射）</span></span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">proxy</span> <span class="operator">=</span> (Mediator) Proxy.newProxyInstance(Mediator.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Mediator.class&#125;, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;动态代理开始&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(<span class="keyword">new</span> <span class="title class_">Landlord</span>());</span><br><span class="line">                System.out.println(<span class="string">&quot;动态代理结束&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> invoke;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//代理开始</span></span><br><span class="line">        proxy.rentHouse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">动态代理开始</span><br><span class="line">房东租出房子，1000元/月。</span><br><span class="line">动态代理结束</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>当我们不知道代理者的时候就可以使用动态代理。</p>
<h3 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h3><p>又叫门面模式，提供了一个统一的接口，用来访问子系统中的一群接口。定义了一个高层接口，让子系统更容易使用。</p>
<p>说白了其实就是对子系统的一个统一。比如拍照，假如我们没有手机这个系统，我们拍照要先启动照相机系统，按下快门调用照相机系统拍照，然后调用存储系统存储照片文件等等等等，涉及的子系统很多调用很麻烦。手机就相当于一个统一，将调子系统的功能都封装起来了，你只需按下拍照按钮即可。</p>
<p>现在我们就以这个为例子来写一下代码：</p>
<p>我们有两个子系统，分别是相机和存储：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Camera</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;打开摄像头....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;关闭摄像头....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">focus</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;聚焦...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getHead</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;检测人脸...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String <span class="title function_">picture</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拍出照片&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RQ527的帅照&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">     <span class="type">boolean</span> <span class="title function_">askPermission</span><span class="params">()</span>&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;申请权限...&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">storePicture</span><span class="params">(String picture)</span>&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;存储照片：&quot;</span>+picture);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用外观模式提供统一接口拍照简化客户端的调用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Camera</span> <span class="variable">camera</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Camera</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Storage</span> <span class="variable">storage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Storage</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">picture</span><span class="params">()</span>&#123;</span><br><span class="line">        camera.open();</span><br><span class="line">        camera.focus();</span><br><span class="line">        camera.getHead();</span><br><span class="line">        <span class="type">String</span> <span class="variable">picture</span> <span class="operator">=</span> camera.picture();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> storage.askPermission();</span><br><span class="line">        <span class="keyword">if</span> (b)&#123;</span><br><span class="line">            storage.storePicture(picture);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;照片存储失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        camera.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        phone.picture();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">打开摄像头....</span><br><span class="line">聚焦...</span><br><span class="line">检测人脸...</span><br><span class="line">拍出照片</span><br><span class="line">申请权限...</span><br><span class="line">存储照片：RQ527的帅照</span><br><span class="line">关闭摄像头....</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到外观模式统一了之后客户端调用是非常方便的。</p>
<h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><p>桥接模式（Bridge）能将抽象与实现分离，使二者可以各自单独变化而不受对方约束，使用时再将它们组合起来，就像架设桥梁一样连接它们的功能，如此降低了抽象与实现这两个可变维度的耦合度，以保证系统的可扩展性。</p>
<p>桥接模式的核心是将抽象和实现分离。在实现过程中，我们可以通过抽象类或者接口来定义抽象部分，通过另一个抽象类或者接口来定义实现部分。然后，我们可以通过组合的方式将两个部分组合起来，使得它们可以独立地变化。</p>
<p>我们举个例子，假如我们现在设计一个西游记地游戏。</p>
<p>首先定义接口武器，统一方法attack：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Weapon</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义另外一个抽象类角色，拥有实现类武器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Weapon weapon;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Role</span><span class="params">(Weapon weapon)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weapon = weapon;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是两个武器的实现类金箍棒和钉耙：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JinGuBang</span> <span class="keyword">implements</span> <span class="title class_">Weapon</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;吃俺老孙一棒！！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DingPa</span> <span class="keyword">implements</span> <span class="title class_">Weapon</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;吃俺老猪一耙！！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是角色的实现类，悟空和八戒：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WuKong</span> <span class="keyword">extends</span> <span class="title class_">Role</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WuKong</span><span class="params">(Weapon weapon)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(weapon);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">        weapon.attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaJie</span> <span class="keyword">extends</span> <span class="title class_">Role</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaJie</span><span class="params">(Weapon weapon)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(weapon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">        weapon.attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Role</span> <span class="variable">wuKong</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WuKong</span>(<span class="keyword">new</span> <span class="title class_">JinGuBang</span>());</span><br><span class="line">        wuKong.attack();</span><br><span class="line"></span><br><span class="line">        <span class="type">Role</span> <span class="variable">baJie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BaJie</span>(<span class="keyword">new</span> <span class="title class_">DingPa</span>());</span><br><span class="line">        baJie.attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">吃俺老孙一棒！！！</span><br><span class="line">吃俺老猪一耙！！！</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>其实可以看到两个抽象类Role和Weapon，通过组合的方式Role拥有一个Weapon的实例，然后二者的实现类互不影响。这就是桥接模式的实现。</p>
<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>组合模式(Composite Design Pattern)，将对象组合成树形结构表示整体-部分的层次结构，使得用户对每个单个对象和组合对象的使用具有一致性。</p>
<p>组合模式跟面向对象设计中的组合关系（通过组合来组装两个类），不同。这里讲的“组合模式”，主要是用来处理树形结构数据。这里的“数据”，你可以简单理解为一组对象集合。</p>
<p><strong>角色</strong>：</p>
<ol>
<li>Component 抽象根节点，为组合中的对象声明接口</li>
<li>Composite 定义有子节点的那些枝干节点的行为，存储子节点，在 Component 接口中实现与子节点有关的操作</li>
<li>Leaf 在组合中表示叶子节点对象，叶子节点没有子节点，在组合中定义节点对象的行为</li>
</ol>
<p>举一个例子：请你设计表示一个学校的所有学院，所有学院下面所有的专业。</p>
<p>这属于树形结构，我们就可以使用组合模式。</p>
<p>首先定义Component 抽象根节点，根节点定义了添加删除结点和打印的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Component</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Component component)</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Component component)</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Composite枝干结点定义，枝干结点分别有University（大学）、College（学院），叶子结点（专业）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//大学</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">University</span> <span class="keyword">extends</span> <span class="title class_">Component</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; colleges = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">University</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        colleges.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        colleges.remove(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------&quot;</span>+name+<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Component component: colleges)&#123;</span><br><span class="line">            component.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学院</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">College</span> <span class="keyword">extends</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; professions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">College</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        professions.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        professions.remove(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------&quot;</span>+name+<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Component component: professions)&#123;</span><br><span class="line">            component.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//专业</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Profession</span> <span class="keyword">extends</span> <span class="title class_">Component</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Profession</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;叶子结点不支持插入操作！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;叶子结点不支持删除操作！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">University</span> <span class="variable">university</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">University</span>(<span class="string">&quot;重庆邮电大学&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">College</span> <span class="variable">college</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">College</span>(<span class="string">&quot;计算机学院&quot;</span>);</span><br><span class="line">        college.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;计算机科学与技术专业&quot;</span>));</span><br><span class="line">        college.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;人工智能专业&quot;</span>));</span><br><span class="line">        college.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;网络工程专业&quot;</span>));</span><br><span class="line">        university.add(college);</span><br><span class="line"></span><br><span class="line">        <span class="type">College</span> <span class="variable">college1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">College</span>(<span class="string">&quot;软件工程学院&quot;</span>);</span><br><span class="line">        college1.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;信息安全专业&quot;</span>));</span><br><span class="line">        college1.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;物联网工程专业&quot;</span>));</span><br><span class="line">        college1.add(<span class="keyword">new</span> <span class="title class_">Profession</span>(<span class="string">&quot;软件设计与开发专业&quot;</span>));</span><br><span class="line">        university.add(college1);</span><br><span class="line"></span><br><span class="line">        university.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--------重庆邮电大学------------</span><br><span class="line">--------计算机学院------------</span><br><span class="line">计算机科学与技术专业</span><br><span class="line">人工智能专业</span><br><span class="line">网络工程专业</span><br><span class="line">--------软件工程学院------------</span><br><span class="line">信息安全专业</span><br><span class="line">物联网工程专业</span><br><span class="line">软件设计与开发专业</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到，组合模式很好地描述了树形结构中部分和整体的关系，统一处理了一个结点中地多个对象。因为其数据结构要求是树形结构导致了他在日常开发中不是那么常用。</p>
<h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><p><strong>定义</strong>：使用共享对象可有效地支持大量地细粒度对象。</p>
<p>“享”即共享，”元“即对象，就是共享对象地意思嘛。</p>
<p>适用于存在大量重复对象，但是重复创建销毁对象非常消耗资源的场景，通过共享池共享对象，达到对象共享，避免创建过多对象。享元对象中的字段可分为部分：内部状态（不随环境变化，可共享）；外部状态（随环境变化，不可共享）。</p>
<p><strong>角色</strong>：</p>
<ol>
<li>抽象享元（FlyWeight）：给出抽象接口，规定所有具体享元角色需要实现的方法</li>
<li>具体享元（ConcreteFlyWeight）：实现抽象享元所规定出的接口；存储内部状态</li>
<li>不共享具体享元（UnsharedConcreteFlyweight）：Flyweight接口使共享成为可能，但它并不强制共享。在Flyweight对象结构的某些层次，UnsharedConcreteFlyweight对象通常将ConcreteFlyweight对象作为子节点。</li>
<li>享元工厂（FlyWeightFactory）：创建和管理享元角色，保证享元对象可被共享；主要通过HashMap来实现。</li>
</ol>
<p>我们还是拿图形的那个例子，这次用享元模式优化对象地获取。</p>
<p>首先是FlyWeight，也就是我们抽象出的Shape：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color 外部状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(String color)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的name其实就是内部状态不随外部环境变化，被创建时就确定了。color其实就是外部状态，随方法的调用而改变。</p>
<p>然后定义ConcreteFlyWeight，也就是Shape的实现类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Triangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Triangle</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                我叫%s。我是%s的三角形。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        System.out.printf(msg,name,color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Oval</span> <span class="keyword">extends</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Oval</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                我叫%s。我是%s的椭圆形。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        System.out.printf(msg,name,color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                我叫%s。我是%s的矩形;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        System.out.printf(msg,name,color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是FlyWeightFactory享元工厂，就是ShapeFactory：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Shape&gt; shapes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> Shape <span class="title function_">getShape</span><span class="params">(String type,String name)</span>&#123;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape</span> <span class="operator">=</span> shapes.get(name);</span><br><span class="line">        <span class="keyword">if</span> (shape==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;椭圆形&quot;</span>:</span><br><span class="line">                    <span class="type">Oval</span> <span class="variable">oval</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Oval</span>(name);</span><br><span class="line">                    shapes.put(name,oval);</span><br><span class="line">                    <span class="keyword">return</span> oval;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;三角形&quot;</span>:</span><br><span class="line">                    <span class="type">Triangle</span> <span class="variable">triangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Triangle</span>(name);</span><br><span class="line">                    shapes.put(name,triangle);</span><br><span class="line">                    <span class="keyword">return</span> triangle;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;矩形&quot;</span>:</span><br><span class="line">                    <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(name);</span><br><span class="line">                    shapes.put(name,rectangle);</span><br><span class="line">                    <span class="keyword">return</span> rectangle;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的Factory可以写成单例模式，我们用Map模拟享元池，每次获取对象先判断享元池中是否存在，存在直接取出，不存在再创建。</p>
<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;三角形&quot;</span>, <span class="string">&quot;阿三&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape1</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;三角形&quot;</span>, <span class="string">&quot;阿三&quot;</span>);</span><br><span class="line">        shape.draw(<span class="string">&quot;红色&quot;</span>);</span><br><span class="line">        shape1.draw(<span class="string">&quot;蓝色&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;两次取出的对象是否相等：&quot;</span>+(shape==shape1));</span><br><span class="line"></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;椭圆形&quot;</span>, <span class="string">&quot;阿圆&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape3</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;椭圆形&quot;</span>, <span class="string">&quot;阿圆&quot;</span>);</span><br><span class="line">        shape2.draw(<span class="string">&quot;黑色&quot;</span>);</span><br><span class="line">        shape3.draw(<span class="string">&quot;白色&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;两次取出的对象是否相等：&quot;</span>+(shape2==shape3));</span><br><span class="line"></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape4</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;矩形&quot;</span>, <span class="string">&quot;阿矩&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape5</span> <span class="operator">=</span> ShapeFactory.getShape(<span class="string">&quot;矩形&quot;</span>, <span class="string">&quot;阿正&quot;</span>);</span><br><span class="line">        shape4.draw(<span class="string">&quot;粉色&quot;</span>);</span><br><span class="line">        shape5.draw(<span class="string">&quot;紫色&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;两次取出的对象是否相等：&quot;</span>+(shape4==shape5));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我叫阿三。我是红色的三角形。</span><br><span class="line">我叫阿三。我是蓝色的三角形。</span><br><span class="line">两次取出的对象是否相等：true</span><br><span class="line">我叫阿圆。我是黑色的椭圆形。</span><br><span class="line">我叫阿圆。我是白色的椭圆形。</span><br><span class="line">两次取出的对象是否相等：true</span><br><span class="line">我叫阿矩。我是粉色的矩形;</span><br><span class="line">我叫阿正。我是紫色的矩形;</span><br><span class="line">两次取出的对象是否相等：false</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到，固有属性相同的对象只有第一次获取的时候才被创建。color外部状态随外界变化而变化，name内部状态一直不变。这就达到了对象复用的效果。当然实际使用中内部状态不止name，外部状态也不止color，具体根据需求而定。</p>
<p>享元模式被广泛使用，诸如线程池，Integer对象地创建，在-127到128之间的对象已经创建好了，在这之外再重新new 的对象。</p>
<h2 id="行为型设计模式"><a href="#行为型设计模式" class="headerlink" title="行为型设计模式"></a>行为型设计模式</h2><h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p><strong>定义</strong>：定义一组算法，将每个算法都封装起来，并且他们之间可以互换。</p>
<p><strong>角色</strong>：</p>
<ol>
<li><strong>上下文角色（context）</strong>：用来操作策略的上下文环境，屏蔽客户端或者高层模块对策略算法的直接访问，封装可能出现的变化。</li>
<li><strong>抽象策略角色（Strategy）</strong>：规定策略的算法或者行为</li>
<li><strong>具体策略角色（ConcreteStrategy）</strong>：具体策略的算法或者行为的实现</li>
</ol>
<p>我们以支付为例，支付的方式有支付宝支付，微信支付，银行卡支付。</p>
<p>抽象策略角色（Strategy），这里用Payment接口抽象支付行为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体策略角色（ConcreteStrategy）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPay</span> <span class="keyword">implements</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;微信支出&quot;</span> + amount + <span class="string">&quot;元。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BankPay</span> <span class="keyword">implements</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;银行卡支出&quot;</span> + amount + <span class="string">&quot;元。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">implements</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;支付宝支出&quot;</span> + amount + <span class="string">&quot;一万元。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上下文角色（context）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Payment payment;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentStrategy</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.payment = payment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(<span class="type">int</span> amount)</span>&#123;</span><br><span class="line">        payment.pay(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">alipay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentStrategy</span>(<span class="keyword">new</span> <span class="title class_">AliPay</span>());</span><br><span class="line">        alipay.execute(<span class="number">100000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">WxPay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentStrategy</span>(<span class="keyword">new</span> <span class="title class_">WechatPay</span>());</span><br><span class="line">        WxPay.execute(<span class="number">99999999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">bankPay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentStrategy</span>(<span class="keyword">new</span> <span class="title class_">BankPay</span>());</span><br><span class="line">        bankPay.execute(<span class="number">123456789</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">支付宝支出100000一万元。</span><br><span class="line">微信支出99999999元。</span><br><span class="line">银行卡支出123456789元。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>策略模式适合用于优化方法中大量的if-else语句，而且策略模式对算法和行为封装性更好更便于维护，安全性更高。</p>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p><strong>定义</strong>：一个抽象类公开定义了执行它的方法的方式&#x2F;模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。</p>
<p>模板在java中很好实现，就是抽象类和继承的运用。</p>
<p>我们这里用讲PPT作为例子。</p>
<p>首先抽象模板：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Presenter</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">getSubject</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">talkEachOther</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isNeedTalk</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">speech</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                我叫%s，今天我要讲的主题是%s。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        System.out.printf(msg,getName(),getSubject());</span><br><span class="line">        <span class="keyword">if</span> (isNeedTalk())&#123;</span><br><span class="line">            talkEachOther();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义了一个模板方法speech，内部调用其他抽象方法作为模板调用，子类无需关心模板的实现，只需实现相应的步骤即可。还定义了一个子类可以选择是否重写的方法isNeedTalk用来决定是否调用talkEachOther方法，我们称这个函数为钩子函数。</p>
<p>具体的演讲者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZhangSan</span> <span class="keyword">extends</span> <span class="title class_">Presenter</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isNeedTalk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ZhangSan</span><span class="params">(<span class="type">boolean</span> isNeedTalk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isNeedTalk = isNeedTalk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getSubject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;科技改变生活&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">talkEachOther</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;同学们激烈当今前沿科技.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isNeedTalk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isNeedTalk;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LiSi</span> <span class="keyword">extends</span> <span class="title class_">Presenter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getSubject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;人工智能&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;李四&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">talkEachOther</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;同学们激烈讨论人工智能是否改变生活......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ZhangSan</span> <span class="variable">zhangSan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZhangSan</span>(<span class="literal">false</span>);</span><br><span class="line">        zhangSan.speech();</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------------------&quot;</span>);</span><br><span class="line">        <span class="type">LiSi</span> <span class="variable">liSi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LiSi</span>();</span><br><span class="line">        liSi.speech();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我叫张三，今天我要讲的主题是科技改变生活。</span><br><span class="line">-------------------------------</span><br><span class="line">我叫李四，今天我要讲的主题是人工智能。</span><br><span class="line">同学们激烈讨论人工智能是否改变生活......</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>在java的特性上实现模板方法模式是比较简单的，模板方法在日常开发中很常用，在一定程度上能减少代码量，提高代码复用性。</p>
<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p><strong>定义</strong>：观察者模式定义了对象之间的一对多依赖，当一个对象改变状态时，它的所有依赖者都会收到通知并自动更新。观察者模式主要有两个对象，主题（被观察者）和订阅者（观察者），这是一个一对多的关系，同一个主题可以有多个订阅者，当主题发生改变时，每个订阅者都能收到消息通知并执行对应的逻辑。</p>
<p>对于主题（被观察者）而言，需要提供注册、去注册、通知观察者的功能。</p>
<p>对于订阅者（观察者）而言，需要提供统一的接口让主题在通知时调用。</p>
<p>我们拿天气订阅来举例子。</p>
<p>首先抽象观察者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onChanged</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体的观察者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WangEr</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChanged</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;王二收到了天气更新&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WangWu</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChanged</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;王五收到了天气更新&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象被观察者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeAllObservers</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObserver</span><span class="params">(<span class="type">int</span> i)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyAllObserver</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>被观察者提供添加、删除观察者的方法，通知观察者的方法。</p>
<p>天气主题（被观察者）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Weather</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeAllObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        observers.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObserver</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">Observer</span> <span class="variable">observer</span> <span class="operator">=</span> observers.get(i);</span><br><span class="line">        <span class="keyword">if</span> (observer!=<span class="literal">null</span>)&#123;</span><br><span class="line">            observer.onChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyAllObserver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer:observers)&#123;</span><br><span class="line">            observer.onChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWeather</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;天气更新，开始通知观察者....&quot;</span>);</span><br><span class="line">        notifyAllObserver();</span><br><span class="line">        System.out.println(<span class="string">&quot;通知完毕。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>被观察者（天气）提供更新天气的方法，内部调用通知观察者的逻辑。</p>
<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Weather</span> <span class="variable">weather</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Weather</span>();</span><br><span class="line">        weather.addObserver(<span class="keyword">new</span> <span class="title class_">WangWu</span>());</span><br><span class="line">        weather.addObserver(<span class="keyword">new</span> <span class="title class_">WangEr</span>());</span><br><span class="line">        weather.addObserver(() -&gt; System.out.println(<span class="string">&quot;匿名用户收到天气更新。&quot;</span>));</span><br><span class="line">        weather.updateWeather();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">天气更新，开始通知观察者....</span><br><span class="line">王五收到了天气更新</span><br><span class="line">王二收到了天气更新</span><br><span class="line">匿名用户收到天气更新。</span><br><span class="line">通知完毕。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>观察者模式降低了目标与观察者之间的耦合关系，两者之间是抽象耦合关系。符合依赖倒置原则。目标与观察者之间建立了一套触发机制。观察者模式精髓在于理解接口回调。</p>
<h3 id="迭代子模式"><a href="#迭代子模式" class="headerlink" title="迭代子模式"></a>迭代子模式</h3><p><strong>定义</strong>：迭代子模式可以顺序地访问一个聚集中的元素而不必暴露聚集的内部表象。我们常见的集合有很多种类，其顶层数据存储和组织方式的不同导致了我们在对数据进行遍历的时候存在一些差异，迭代器模式就是通过实现某种统一的方式来实现对不同的集合的遍历，同时又不暴露出其底层的数据存储和组织方式。</p>
<p>常规的for循遍历对于集合来说耦合度太大，不便于维护，假如集合被修改，for循环也需要更改。</p>
<p><strong>角色</strong>：</p>
<ul>
<li>迭代器角色（Iterator）: 负责定义访问和遍历元素的接口。</li>
<li>具体迭代器角色（Concrete Iterator）：实现迭代器接口，并要记录遍历中的当前位置。</li>
<li>容器角色(Container): 负责提供创建具体迭代器角色的接口。</li>
<li>具体容器角色（Concrete Container）：实现创建具体迭代器角色的接口， 这个具体迭代器角色与该容器的结构相关。</li>
</ul>
<p>下面我们来写一写我们自己的迭代器。</p>
<p>抽象迭代器（Iterator）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">first</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">previous</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代器有四个方法，判断是否有下一个元素，获取第一个元素、下一个元素、前一个元素。</p>
<p>具体的迭代器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyIterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyIterator</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index != list.size() - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">first</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!list.isEmpty()) <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">previous</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index!=<span class="number">0</span>) <span class="keyword">return</span> list.get(index-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index&lt;list.size()) <span class="keyword">return</span> list.get(++index);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对四个方法具体实现，内部维护一个list和index，对外统一获取元素的方法。</p>
<p>抽象容器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Container</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T data)</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(T data)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三个方法，添加、删除元素，获取迭代器。</p>
<p>具体容器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyList</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Container</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyIterator</span>&lt;T&gt;(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        list.add(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.remove(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        MyList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">MyList</span>&lt;Integer&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">5</span>);</span><br><span class="line">        list.add(<span class="number">6</span>);</span><br><span class="line">        list.add(<span class="number">8</span>);</span><br><span class="line">        list.add(<span class="number">4</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Iterator&lt;Integer&gt; iterator = list.iterator();</span><br><span class="line">        System.out.println(<span class="string">&quot;第一个数&quot;</span> + iterator.first());</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;之前的数&quot;</span> + iterator.previous());</span><br><span class="line">            System.out.println(<span class="string">&quot;下一个数&quot;</span> + iterator.next());</span><br><span class="line">            System.out.println(<span class="string">&quot;-----------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第一个数1</span><br><span class="line">--------------------------</span><br><span class="line">之前的数null</span><br><span class="line">下一个数5</span><br><span class="line">-----------------------------</span><br><span class="line">之前的数1</span><br><span class="line">下一个数6</span><br><span class="line">-----------------------------</span><br><span class="line">之前的数5</span><br><span class="line">下一个数8</span><br><span class="line">-----------------------------</span><br><span class="line">之前的数6</span><br><span class="line">下一个数4</span><br><span class="line">-----------------------------</span><br><span class="line">之前的数8</span><br><span class="line">下一个数2</span><br><span class="line">-----------------------------</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>实现了我们统一迭代的需求。这里只是实例迭代子模式的使用，实际上我们不用自己去封装，像List，Map等java提供了封装好的Iterator。</p>
<h3 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h3><p><strong>定义</strong>：<strong>责任链模式</strong>是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。</p>
<p>一般责任链是用链表的形式将每个处理者串起来，我比较喜欢用集合，然后一条链将他们串起来，这也是Okhttp责任链的做法。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>抽象责任链（Chain）</strong>：抽象责任链的传递方法，提供获取请求的接口。</li>
<li><strong>具体责任链</strong>：实现抽象责任链，串起每个处理者。</li>
<li><strong>抽象处理者（Handler）角色：</strong>定义一个处理请求的接口，包含抽象处理方法。</li>
<li><strong>具体处理者（Concrete Handler）角色：</strong>实现抽象处理者的处理方法，判断能否处理本次请求，如果可以处理请求则处理，否则将该请求转给它的后继者。</li>
<li><strong>客户类（Client）角色：</strong>创建处理链，并向链头的具体处理者对象提交请求，它不关心处理细节和请求的传递过程。</li>
</ul>
<p>我们这里举个例子，发个消息然后让每个处理者决定是否处理。</p>
<p>首先抽象责任链：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Chain</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">getRequest</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">process</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提供两个方法，一个是获取数据，一个是将请求传递。</p>
<p>抽象处理者（Handler）角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Handler</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Chain&lt;T&gt; chain)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消息bean：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> level;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLevel</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>责任链的具体实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealChain</span> <span class="keyword">implements</span> <span class="title class_">Chain</span>&lt;Message&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Handler&lt;Message&gt;&gt; interceptors;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RealChain</span><span class="params">(List&lt;Handler&lt;Message&gt;&gt; interceptors, <span class="type">int</span> index, Message message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.interceptors = interceptors;</span><br><span class="line">        <span class="built_in">this</span>.index = index;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Message <span class="title function_">getRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= interceptors.size()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">RealChain</span> <span class="variable">next</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RealChain</span>(interceptors, index + <span class="number">1</span>, message);</span><br><span class="line">        interceptors.get(index).handle(next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拥有三个属性，处理者集合，当前处理者索引和请求体message。process将每个处理者串起来。</p>
<p>模拟具体的处理者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteHandler1</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;Message&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Chain&lt;Message&gt; chain)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">request</span> <span class="operator">=</span> chain.getRequest();</span><br><span class="line">        System.out.println(<span class="string">&quot;传递到处理者1，内容：&quot;</span> + request.getContent() + <span class="string">&quot;，等级：&quot;</span> + request.getLevel());</span><br><span class="line">        request.setContent(<span class="string">&quot;我处理者1处理了消息。&quot;</span>);</span><br><span class="line">        chain.process();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteHandler2</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;Message&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Chain&lt;Message&gt; chain)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">request</span> <span class="operator">=</span> chain.getRequest();</span><br><span class="line">        System.out.println(<span class="string">&quot;传递到处理者2，内容：&quot;</span> + request.getContent() + <span class="string">&quot;，等级：&quot;</span> + request.getLevel());</span><br><span class="line">        request.setContent(<span class="string">&quot;我处理者2处理了消息。&quot;</span>);</span><br><span class="line">        chain.process();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteHandler3</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;Message&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Chain&lt;Message&gt; chain)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">request</span> <span class="operator">=</span> chain.getRequest();</span><br><span class="line">        System.out.println(<span class="string">&quot;传递到处理者3，内容：&quot;</span> + request.getContent() + <span class="string">&quot;，等级：&quot;</span> + request.getLevel());</span><br><span class="line">        request.setContent(<span class="string">&quot;我处理者3处理了消息。&quot;</span>);</span><br><span class="line">        chain.process();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>chain.process();即表示将请求传递，我这里并没有拦截，实际开发中可以自行判断是否拦截。</p>
<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;Handler&lt;Message&gt;&gt; chains = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        chains.add(<span class="keyword">new</span> <span class="title class_">ConcreteHandler1</span>());</span><br><span class="line">        chains.add(<span class="keyword">new</span> <span class="title class_">ConcreteHandler2</span>());</span><br><span class="line">        chains.add(<span class="keyword">new</span> <span class="title class_">ConcreteHandler3</span>());</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        message.setContent(<span class="string">&quot;我是消息的具体内容。&quot;</span>);</span><br><span class="line">        message.setLevel(<span class="number">99</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RealChain</span>(chains, <span class="number">0</span>, message).process();</span><br><span class="line">        System.out.println(<span class="string">&quot;责任链传递完毕，message：内容：&quot;</span> + message.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">传递到处理者1，内容：我是消息的具体内容。，等级：99</span><br><span class="line">传递到处理者2，内容：我处理者1处理了消息。，等级：99</span><br><span class="line">传递到处理者3，内容：我处理者2处理了消息。，等级：99</span><br><span class="line">责任链传递完毕，message：内容：我处理者3处理了消息。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>责任链适合用于多流程控制，权限的控制。更有助于优化if-else语句，方便维护和扩展。</p>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p><strong>定义</strong>：命令模式（Command Pattern）是一种数据驱动的设计模式，它属于行为型模式。请求以命令的形式包裹在对象中，并传给调用对象。调用对象寻找可以处理该命令的合适的对象，并把该命令传给相应的对象，该对象执行命令。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>抽象接受者（Receiver）</strong>：命令接受者的抽象，提供执行的方法。</li>
<li><strong>具体接受者（ConcreteReceiever）</strong>：抽象接受者的具体实现，内部实现命令执行的方法。</li>
<li><strong>抽象命令角色（Command）</strong>：下发命令的角色，执行的命令在这里声明。</li>
<li><strong>具体命令角色（ConcreteCommand）</strong>：命令角色的具体实现，持有Receiver，收到命令后下发给每个Receiver</li>
<li><strong>调用者角色（Invoker）</strong>：命令的发动者和调用者。</li>
</ul>
<p>我们用代码简单实现一下：</p>
<p>首先是抽象接受者和命令者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">action</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体的接受者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteReceiver1</span> <span class="keyword">implements</span> <span class="title class_">Receiver</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收者1执行命令。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteReceiver2</span> <span class="keyword">implements</span> <span class="title class_">Receiver</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收者2执行命令。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteReceiver3</span> <span class="keyword">implements</span> <span class="title class_">Receiver</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收者3执行命令。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体的命令角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Receiver&gt; receivers;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteCommand</span><span class="params">(List&lt;Receiver&gt; receivers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.receivers = receivers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Receiver receiver : receivers) &#123;</span><br><span class="line">            receiver.action();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>命令的发动者和调用者，Invoker：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Invoker</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>&#123;</span><br><span class="line">        command.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Receiver&gt; receivers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        receivers.add(<span class="keyword">new</span> <span class="title class_">ConcreteReceiver1</span>());</span><br><span class="line">        receivers.add(<span class="keyword">new</span> <span class="title class_">ConcreteReceiver2</span>());</span><br><span class="line">        receivers.add(<span class="keyword">new</span> <span class="title class_">ConcreteReceiver3</span>());</span><br><span class="line">        <span class="type">Invoker</span> <span class="variable">invoker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Invoker</span>(<span class="keyword">new</span> <span class="title class_">ConcreteCommand</span>(receivers));</span><br><span class="line">        invoker.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">接收者1执行命令。</span><br><span class="line">接收者2执行命令。</span><br><span class="line">接收者3执行命令。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h3 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h3><p><strong>定义</strong>： 在不破坏封装性的前提下, 捕获一个对象的内部状态, 并在该对象之外保存这个状态. 这样以后就可将该对象回复到原先保存的状态。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>Originator 发起人角色</strong>: 记录当前时刻的内部状态, 负责定义哪些属于备份范围的状态, 负责创建和恢复备忘录数据</li>
<li><strong>Memento 备忘录角色</strong>: 负责存储 发起人对象的内部状态, 在需要的时候提供发起人需要的内部状态</li>
<li><strong>Caretaker 备忘录管理员角色</strong>: 对备忘录进行管理、保存和提供备忘录.</li>
</ul>
<p>还是老规矩写个demo：</p>
<p>Memento 备忘录角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Memento</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Originator 发起人角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">createMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        state = memento.getState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Caretaker 备忘录管理员角色：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Memento memento;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">getMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memento;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memento = memento;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Originator</span> <span class="variable">originator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Originator</span>();</span><br><span class="line">        <span class="type">Caretaker</span> <span class="variable">caretaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Caretaker</span>();</span><br><span class="line">        originator.setState(<span class="string">&quot;状态1&quot;</span>);</span><br><span class="line">        caretaker.setMemento(originator.createMemento());</span><br><span class="line">        originator.setState(<span class="string">&quot;状态2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;恢复状态之前，状态：&quot;</span> + originator.getState());</span><br><span class="line">        originator.restoreMemento(caretaker.getMemento());</span><br><span class="line">        System.out.println(<span class="string">&quot;恢复状态之后，状态：&quot;</span> + originator.getState());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">恢复状态之前，状态：状态2</span><br><span class="line">恢复状态之后，状态：状态1</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>备忘录模式用的比较多，像游戏存档，文档回退等等都用到了备忘录模式，demo实现的比较简单，篇幅原因真正的实现细节这里就不多说了。</p>
<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p><strong>定义</strong>：允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它所属的类。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>State</strong>：抽象状态类或者接口，其中的方法表示对应状态下的行为。</li>
<li><strong>StateA、StateB</strong>：<strong>State</strong>的具体实现类，以实现对应状态下具体的行为。</li>
<li><strong>Context</strong>：维护当前对象所对应的状态。</li>
</ul>
<p>我们拿出租车举例子。</p>
<p>首先抽象State：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是出租车的两个状态：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoPassengerState</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;空车，待接客。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HasPassengerState</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;有客，不接单。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>出租车Context：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaxiContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TaxiContext</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receivePassenger</span><span class="params">()</span>&#123;</span><br><span class="line">        state = <span class="keyword">new</span> <span class="title class_">HasPassengerState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completeCarry</span><span class="params">()</span>&#123;</span><br><span class="line">        state = <span class="keyword">new</span> <span class="title class_">NoPassengerState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;收到订单...&quot;</span>);</span><br><span class="line">        state.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TaxiContext</span> <span class="variable">taxiContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TaxiContext</span>(<span class="keyword">new</span> <span class="title class_">NoPassengerState</span>());</span><br><span class="line">        taxiContext.receiveOrder();</span><br><span class="line">        taxiContext.receivePassenger();</span><br><span class="line">        taxiContext.receiveOrder();</span><br><span class="line">        taxiContext.completeCarry();</span><br><span class="line">        taxiContext.receiveOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">----------------------</span><br><span class="line">收到订单...</span><br><span class="line">空车，待接客。</span><br><span class="line">----------------------</span><br><span class="line">收到订单...</span><br><span class="line">有客，不接单。</span><br><span class="line">----------------------</span><br><span class="line">收到订单...</span><br><span class="line">空车，待接客。</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h3 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h3><p><strong>定义</strong>：封装一些作用于某种数据结构中的各元素操作，它可以在不改变数据结构的前提下定义作用于这些元素的新的操作。</p>
<p><strong>角色</strong>：</p>
<ul>
<li>元素类（Element）：是一个抽象类或者接口，里面会定义一个接收(accept)访问者的抽象方法,使得每一个元素能被访问者访问。</li>
<li>具体元素（ConcreteElement）：继承或实现元素类，实现接收方法。</li>
<li>访问者（Visitor）：一般是一个抽象类，里面涵括了可以访问每个具体元素的方法，使得访问者可以访问每个具体元素（一般有几个具体元素就会有几个这个样的方法，这些方法的方法名相同参数不同，参数都是具体元素，所以一般来说具体元素的种类应该是比较固定的）。</li>
<li>具体访问者（ConcreteVisitor）：访问者的具体实现</li>
</ul>
<p>模版代码：</p>
<p>元素类和具体元素：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Element</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Element</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteElement1</span> <span class="keyword">extends</span> <span class="title class_">Element</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteElement1</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteElement2</span> <span class="keyword">extends</span> <span class="title class_">Element</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteElement2</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问者和具体访问者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(ConcreteElement1 element)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(ConcreteElement2 element2)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteVisitor</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(ConcreteElement1 element)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;访问到元素1，信息：&quot;</span>+element.content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(ConcreteElement2 element)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;访问到元素2，信息：&quot;</span>+element.content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConcreteElement1</span> <span class="variable">element1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteElement1</span>(<span class="string">&quot;元素1的内容&quot;</span>);</span><br><span class="line">        <span class="type">ConcreteElement2</span> <span class="variable">element2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteElement2</span>(<span class="string">&quot;元素2的内容&quot;</span>);</span><br><span class="line">        element1.accept(<span class="keyword">new</span> <span class="title class_">ConcreteVisitor</span>());</span><br><span class="line">        element2.accept(<span class="keyword">new</span> <span class="title class_">ConcreteVisitor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">访问到元素1，信息：元素1的内容</span><br><span class="line">访问到元素2，信息：元素2的内容</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>访问者模式适合数据结构稳定，作用于数据结构的操作经常变化的时候，对于新增的元素会非常困难，实现起来也比较复杂。</p>
<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p><strong>定义</strong>：用一个中介者对象来封装一系列的对象交互。中介者使得各对象不需要显式地相互引用，从而使其松散耦合，而且可以独立地改变它们之间的交互。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>Mediator</strong>：中介者定义一个接口用于与各同事（Colleague）对象通信。</li>
<li><strong>ConcreteMediator</strong>：具体中介者通过协调各同事对象实现协作行为，了解并维护它的各个同事。</li>
<li><strong>Colleague</strong>：抽象同事类。</li>
<li><strong>Colleagueclass</strong>：具体同事类。每个具体同事类都只需要知道自己的行为即可，但是他们都需要认识中介者。</li>
</ul>
<p>模版代码，我们以同事之间发消息为例：</p>
<p>Colleague和Mediator定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Colleague</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">contact</span><span class="params">(String content)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String content, Colleague colleague)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同事A和同事B的定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColleagueA</span> <span class="keyword">extends</span> <span class="title class_">Colleague</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ColleagueA</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contact</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        mediator.notify(content,<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColleagueB</span> <span class="keyword">extends</span> <span class="title class_">Colleague</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ColleagueB</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contact</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        mediator.notify(content,<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体中介者的定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    ColleagueA colleagueA;</span><br><span class="line">    ColleagueB colleagueB;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ColleagueA <span class="title function_">getColleagueA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> colleagueA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColleagueA</span><span class="params">(ColleagueA colleagueA)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.colleagueA = colleagueA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ColleagueB <span class="title function_">getColleagueB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> colleagueB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColleagueB</span><span class="params">(ColleagueB colleagueB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.colleagueB = colleagueB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String content, Colleague colleague)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (colleague == colleagueA) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;同事B收到消息A的消息：&quot;</span> + content);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (colleague == colleagueB) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;同事A收到消息B的消息：&quot;</span> + content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConcreteMediator</span> <span class="variable">mediator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>();</span><br><span class="line">        <span class="type">ColleagueA</span> <span class="variable">colleagueA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColleagueA</span>(mediator);</span><br><span class="line">        <span class="type">ColleagueB</span> <span class="variable">colleagueB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColleagueB</span>(mediator);</span><br><span class="line">        mediator.setColleagueA(colleagueA);</span><br><span class="line">        mediator.setColleagueB(colleagueB);</span><br><span class="line">        colleagueA.contact(<span class="string">&quot;同事A发的消息&quot;</span>);</span><br><span class="line">        colleagueB.contact(<span class="string">&quot;同事B发的消息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">同事B收到消息A的消息：同事A发的消息</span><br><span class="line">同事A收到消息B的消息：同事B发的消息</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>中介者模式和代理模式有点类似，主要区别在于中介者模式是一对多的关系，解耦的是多个复杂对象之间的复杂交互，代理模式在于一对一，委托者和代理者是一一对应的。</p>
<h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><p><strong>定义</strong>：指给分析对象定义一个语言，并定义该语言的文法表示，再设计一个解析器来解释语言中的句子。</p>
<p><strong>角色</strong>：</p>
<ul>
<li><strong>抽象表达式</strong>(Expression)角色：声明一个所有的具体表达式角色都需要实现的抽象接口。</li>
<li><strong>终结符表达式</strong>(Terminal Expression)角色：实现了抽象表达式角色所要求的接口，主要是一个解释()方法。</li>
<li><strong>非终结符表达式</strong>(Nonterminal Expression)角色：文法中的每一条规则都需要一个具体的非终结符表达式。</li>
<li><strong>环境</strong>(Context)角色：这个角色的任务一般是用来存放文法中各个终结符所对应的具体值。</li>
</ul>
<p>我们以解释java语句为例：</p>
<p>首先抽象表达式：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">explain</span><span class="params">(String context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>终结符表达式：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TerminalExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TerminalExpression</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">explain</span><span class="params">(String context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.contains(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>非终结者表达式：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression expression1;</span><br><span class="line">    <span class="keyword">private</span> Expression expression2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AndExpression</span><span class="params">(Expression expression1, Expression expression2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.expression1 = expression1;</span><br><span class="line">        <span class="built_in">this</span>.expression2 = expression2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">explain</span><span class="params">(String context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expression1.explain(context) &amp;&amp; expression2.explain(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression expression1;</span><br><span class="line">    <span class="keyword">private</span> Expression expression2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrExpression</span><span class="params">(Expression expression1, Expression expression2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.expression1 = expression1;</span><br><span class="line">        <span class="built_in">this</span>.expression2 = expression2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">explain</span><span class="params">(String context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expression1.explain(context) || expression2.explain(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>环境Context这里就用字符串来代表java语言环境了。</p>
<p>客户端测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TerminalExpression</span> <span class="variable">aPublic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;public&quot;</span>);</span><br><span class="line">        <span class="type">TerminalExpression</span> <span class="variable">aVoid</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;void&quot;</span>);</span><br><span class="line">        <span class="type">AndExpression</span> <span class="variable">isVoidFun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AndExpression</span>(aPublic, aVoid);</span><br><span class="line"></span><br><span class="line">        <span class="type">TerminalExpression</span> <span class="variable">aClass</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        <span class="type">TerminalExpression</span> <span class="variable">anInterface</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;interface&quot;</span>);</span><br><span class="line">        <span class="type">OrExpression</span> <span class="variable">isClassOrInterface</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrExpression</span>(aClass, anInterface);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">javaVoidFun</span> <span class="operator">=</span> <span class="string">&quot;public void test()&#123;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">kotlinVoidFun</span> <span class="operator">=</span> <span class="string">&quot;fun test():Unit&#123;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">javaClass</span> <span class="operator">=</span> <span class="string">&quot;class Test&#123;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">javaInterface</span> <span class="operator">=</span> <span class="string">&quot;interface Expression&#123;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\&quot;&quot;</span> + javaVoidFun + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;是无返回值方法？：&quot;</span> + isVoidFun.explain(javaVoidFun));</span><br><span class="line">        System.out.println(<span class="string">&quot;\&quot;&quot;</span> + kotlinVoidFun + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;是无返回值方法？：&quot;</span> + isVoidFun.explain(kotlinVoidFun));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\&quot;&quot;</span> + javaClass + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;是类或者接口？：&quot;</span> + isClassOrInterface.explain(javaClass));</span><br><span class="line">        System.out.println(<span class="string">&quot;\&quot;&quot;</span> + javaInterface + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;是类或者接口？：&quot;</span> + isClassOrInterface.explain(javaInterface));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;public void test()&#123;&#125;&quot;是无返回值方法？：true</span><br><span class="line">&quot;fun test():Unit&#123;&#125;&quot;是无返回值方法？：false</span><br><span class="line">&quot;class Test&#123;&#125;&quot;是类或者接口？：true</span><br><span class="line">&quot;interface Expression&#123;&#125;&quot;是类或者接口？：true</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>解释模式应用场景很多，常见的有SQL解析，xml解析等等等等。</p>
<h2 id="学完总结"><a href="#学完总结" class="headerlink" title="学完总结"></a>学完总结</h2><p>23种设计模式在实际应用场景中常用的模式也就几种，比如工厂模式，建造者模式，代理模式，享元模式，观察者模式等等，其他模式不必过多研究，遇到再来琢磨即可。设计模式一个重要思想是面向接口编程，面向抽象编程，最大程度解耦。设计模式其实也是java三大特性的灵活运用。设计模式代码虽然耦合度低，扩展性好，但不可过度设计，过度设计只会写出虚而不实的代码，让人感觉是为了设计而设计。设计模式是在不断地迭代，不断地重构中考虑的。实际开发中，能简则简，以别人能看懂你写的代码为主，应用设计模式往往是多种设计模式组合使用，比如工厂模式+原型模式，建造者模式+代理模式。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://rq527.github.io">RQ527</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://rq527.github.io/rq/cf6c3d31.html">http://rq527.github.io/rq/cf6c3d31.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://rq527.github.io" target="_blank">RayQuester</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="/img/header.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/rq/22f4c025.html" title="一名（深陷Android无法自拔的）大二狗的年中总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">一名（深陷Android无法自拔的）大二狗的年中总结</div></div></a></div><div class="next-post pull-right"><a href="/rq/9f08fd9f.html" title="一文搞清楚Handler，再也不怕面试官"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">一文搞清楚Handler，再也不怕面试官</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODQ1Mi8zNDkxNQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/header.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">RQ527</div><div class="author-info__description">=与其诅咒黑暗，不如点亮蜡烛=</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RQ527"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/RQ527" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://juejin.cn/user/3228640351367704" target="_blank" title="稀土掘金"><i class="fas fa-book-open"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎您的到来，希望我的文章能对您有所帮助，若有疑问和文章建议欢迎评论~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">为什么要学设计模式？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%A7%8D%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">设计模式种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%B5%E5%BE%AA%E7%9A%84%E4%B8%83%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">3.</span> <span class="toc-text">遵循的七大原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">创造型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.3.</span> <span class="toc-text">抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">建造者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.4.</span> <span class="toc-text">原型模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">适配器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">装饰模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">5.3.1.</span> <span class="toc-text">静态代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">5.3.2.</span> <span class="toc-text">动态代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.4.</span> <span class="toc-text">外观模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.</span> <span class="toc-text">桥接模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.6.</span> <span class="toc-text">组合模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.7.</span> <span class="toc-text">享元模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">行为型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.2.</span> <span class="toc-text">模板方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.3.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%AD%90%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text">迭代子模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.5.</span> <span class="toc-text">责任链模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.6.</span> <span class="toc-text">命令模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.7.</span> <span class="toc-text">备忘录模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.8.</span> <span class="toc-text">状态模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.9.</span> <span class="toc-text">访问者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.10.</span> <span class="toc-text">中介者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.11.</span> <span class="toc-text">解释器模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E5%AE%8C%E6%80%BB%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">学完总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rq/22f4c025.html" title="一名（深陷Android无法自拔的）大二狗的年中总结">一名（深陷Android无法自拔的）大二狗的年中总结</a><time datetime="2023-07-18T12:52:31.632Z" title="发表于 2023-07-18 20:52:31">2023-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rq/cf6c3d31.html" title="设计模式学习笔记">设计模式学习笔记</a><time datetime="2023-05-29T08:10:26.110Z" title="发表于 2023-05-29 16:10:26">2023-05-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rq/9f08fd9f.html" title="一文搞清楚Handler，再也不怕面试官">一文搞清楚Handler，再也不怕面试官</a><time datetime="2023-04-25T04:36:29.000Z" title="发表于 2023-04-25 12:36:29">2023-04-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rq/260b5af1.html" title="Jetpack之四：ViewModel">Jetpack之四：ViewModel</a><time datetime="2023-04-04T10:35:59.000Z" title="发表于 2023-04-04 18:35:59">2023-04-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rq/e6b8b5a8.html" title="Jetpack之三：LiveData">Jetpack之三：LiveData</a><time datetime="2023-03-27T07:56:39.000Z" title="发表于 2023-03-27 15:56:39">2023-03-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By RQ527</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>